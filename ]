{-# LANGUAGE Strict #-}
{-# LANGUAGE KindSignatures #-}
{-# LANGUAGE TypeOperators #-}
module Paracletus.Vulkan.Tile where
-- vulkan specific translations from
-- the tiles array to a bunch of vertices
import Prelude()
import UPrelude
import Graphics.Vulkan.Core_1_0
import Numeric.DataFrame
import Numeric.Dimensions
import Paracletus.Data
import Paracletus.Vulkan.Vertex

vertices ∷ [GTile] → DataFrame Vertex '[XN 3]
vertices tiles = XFrame $ combineVertices tiles

combineVertices ∷ [GTile] → DataFrame Vertex '[m]
combineVertices tiles = dfsquare

dfsquare ∷ DataFrame Vertex '[4]
dfsquare = fromFlatList (D4 :* U) (Vertex 0 0 0)
          [ Vertex (vec3 (-1) (-1) 0) (vec3 1 0 0) (vec3 0 1 0.1)
          , Vertex (vec3   1  (-1) 0) (vec3 0 1 0) (vec3 1 1 0.1)
          , Vertex (vec3   1    1  0) (vec3 0 0 1) (vec3 1 0 0.1)
          , Vertex (vec3 (-1)   1  0) (vec3 1 1 1) (vec3 0 0 0.1) ]

indices ∷ [GTile] → DataFrame Word32 '[XN 3]
indices tiles = atLeastThree $ fromList $ (combineIndices tiles)
combineIndices ∷ ∀ a. (Num a) ⇒ [GTile] → [a]
combineIndices []           = []
combineIndices (tile:tiles) = oneRectIndices ⧺ (combineIndices tiles)
  where oneRectIndices = [0,3,2,2,1,0]
